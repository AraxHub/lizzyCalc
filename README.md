# lizzyCalc

## Эта ветка: конфиг из env (godotenv + envconfig)

Один обучающий файл: `cmd/env/main.go`. Показывает, как выносить настройки в переменные окружения и читать их через две библиотеки.

---

### Зачем переменные окружения

- **Локально** — не хардкодить пароли и порты в коде; хранить в `.env` (файл в .gitignore).
- **В проде** — хостинг (Heroku, K8s, Docker) передаёт конфиг через env; один и тот же бинарник работает с разными настройками.

---

### godotenv

**Библиотека:** `github.com/joho/godotenv`

**Что делает:** читает файл `.env` (строки вида `KEY=VALUE`) и добавляет их в `os.Environ()`. После вызова `godotenv.Load()` все переменные из файла доступны через `os.Getenv("KEY")`.

**В коде:**
```go
if err := godotenv.Load(); err != nil {
    log.Printf("файл .env не найден: %v", err)
}
```
Ошибку часто игнорируют: в проде `.env` обычно нет, переменные уже заданы в окружении.

**Файл .env** (не коммитить): создаётся из `.env.example`, в нём лежат `APP_PORT=8080` и т.д.

---

### envconfig

**Библиотека:** `github.com/kelseyhightower/envconfig`

**Что делает:** заполняет структуру из переменных окружения. Имена переменных задаются тегом `env`, значение по умолчанию — тегом `default`.

**В коде:** объявляем структуру с тегами:
```go
type Config struct {
    Port string `env:"APP_PORT" default:"8080"`
}
var cfg Config
envconfig.Process("", &cfg)
// cfg.Port теперь значение APP_PORT или "8080"
```

**Теги:**
- `env:"ИМЯ"` — из какой переменной брать значение.
- `default:"значение"` — если переменная не задана.
- Префикс в `Process("APP", &cfg)` — ищет переменные с префиксом `APP_` (у нас префикс уже в имени, поэтому префикс `""`).

Итог: один раз описал структуру — весь конфиг приложения типизирован и заполняется из env.

---

### Порядок работы в main

1. **godotenv.Load()** — подтянуть `.env` в окружение (для локального запуска).
2. **envconfig.Process("", &cfg)** — заполнить структуру `Config` из окружения (и из .env, т.к. он уже загружен).
3. Дальше используем `cfg.Port`, `cfg.DBURL` и т.д. в коде сервера/БД.

---

### Как запустить

```bash
# опционально: скопировать пример и подправить
cp .env.example .env

# из корня репо
go run cmd/env/main.go
```

Если есть `.env` — будут использованы значения из него; иначе сработают `default` в тегах.
